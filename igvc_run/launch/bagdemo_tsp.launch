<!--igvc_run.launch-->
<launch>

 <!-- =============   bagfiles  =======================-->
<param name="use_sim_time" value="true"/>

<!--This line sets the path to the ROS bagfiles to run -->
<arg name="path" default="$(env HOME)/catkin_ws/rosbags/goForward10ft/" />

<!--These are the bag files to run 
<arg name="enc_raw" default="$(arg path)enc_raw.bag" />   -->
<arg name="gps" default="$(arg path)gps_fix.bag" />
<arg name="imu" default="$(arg path)imudata.bag" />
<!--
<arg name="rCamera" default="$(arg path)right_camera.bag" />
<arg name="lCamera" default="$(arg path)left_camera.bag" />
<arg name="combinedCamera" default="$(arg path)camera_combined.bag" />
<arg name="laser3D" default="$(arg path)pointcloud.bag" />
  -->
<!-- This line runs all the bag files specified above -->
<node pkg="rosbag" type="play" name="player" output="screen" 
    args=" -r 0.5 --clock $(arg gps) $(arg imu)"/>

<!-- =============   TRANSFORMS  ======================= -->
  <node pkg="tf" type="static_transform_publisher" name="base_link_to_velodyne"
        args="0.1 0.0 1.14 0 0 0 1 base_link velodyne 100" />

  <node pkg="tf" type="static_transform_publisher" name="base_link_to_gps_frame"
        args="-0.52 0.0 0.92 0 0 0 1 base_link gps_frame 100" />

  <node pkg="tf" type="static_transform_publisher" name="base_link_to_imu_frame"
        args="0 0 0 0 0 0 1 base_link imu_frame 100" />

  <node pkg="tf" type="static_transform_publisher" name="base_link_to_left_camera_frame"
        args="0.27 0.06 1.08 0 0.75 0 base_link left_camera_frame 100" />

  <node pkg="tf" type="static_transform_publisher" name="base_link_to_right_camera_frame"
        args="0.27 -0.06 1.08 0 0.75 0 base_link right_camera_frame 100" />

  <node pkg="tf" type="static_transform_publisher" name="base_link_to_left_wheel_frame"
        args="0.27 0.28 -0.47 0 0 0 1 base_link left_wheel_frame 100" />

  <node pkg="tf" type="static_transform_publisher" name="base_link_to_right_wheel_frame"
        args="0.27 -0.28 -0.47 0 0 0 1 base_link right_wheel_frame 100" />

  <node pkg="tf" type="static_transform_publisher" name="base_footprint_to_base_link"
        args="0 0 0.47 0 0 0 1 base_footprint base_link 100" />

<node pkg="tf" type="static_transform_publisher" name="odom_to_map"
        args="0 0 0 0 0 0 1 map odom 100" />

<!-- =============   NODES and Launch Files  ======================= -->
<!--
 run gps_imu node seperately first.. you need to run it twice because the current code gives the initazymuth too soon for the cns to process it correctly. dont run it more than twice. power off cns and reatart process if node ends.
<node name="novatel_CNS5000" pkg="gps_imu" type="usma_novatel_driver.py" output="screen"/>-->


<node name="gps_conv" pkg="gps_common" type="utm_odometry_node">
  <remap from="odom" to="vo"/>
  <remap from="fix" to="/gps/fix" />
  <param name="frame_id" value="base_footprint" />
</node>

  <include file="$(find igvc_run)/launch/dml_ekf.launch">
  </include>

  <include file="$(find igvc_run)/launch/dml_move_base.launch">
  </include>
<!---->
  <include file="$(find igvc_roboteq)/launch/roboteq_driver.launch">
  </include> 

<!--creates bag files that get overwritten each time this runs-->
<node name="bags" pkg="igvc_run" type="rosbagRecord.sh" />

<!-- Start an rviz node with a custom configuration  -->
<node pkg="rviz" type="rviz" output="screen" name="rviz" args="-d $(find igvc_run)/launch/bagdemo_localization.rviz"/>
</launch>

