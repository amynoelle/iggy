<!DOCTYPE html>
<html>
<head>
<title> IGVC Diagnostics </title>
<meta charset="utf-8" />
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/simple.css">
<link rel="stylesheet" href="js/jquery-ui.css">
<link rel="stylesheet" href="css/bootstrap-theme.min.css">
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/eventemitter2.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.min.js"></script>
<script src="js/roslib.js"></script>
<script>
 
  // Connecting to ROS
  // -----------------
  var ros = new ROSLIB.Ros();
  var topics = [];
  var realData = ""
  //~ 
// ========== /RAW_DATA TOPIC SUBSCRIPTION ========== //
 
	var rawData = new ROSLIB.Topic({ 		// Identifies the name and type of topic you want to subscribe to
		ros : ros,
		name : '/novatel/raw_data', // rostopic list to get topics
		messageType : 'std_msgs/String' // rostopic type to get messageType
	}); 
	   
	rawData.subscribe(function(message) {	// Actually subscribes. Anything done with the data MUST be inside the .subscribe brackets
		realData = message.data;
		//console.log(message.data)
	  	var dataArray = realData.split(",");	//splits data by commas
		var lastElem = dataArray[20].split("*");	// last bit has '*' and crap after it, so splits on '*;
	  	document.getElementById("ins-sub").innerHTML = "Steering Status: " + dataArray[4] + "<br><br> INS Alignment: " + lastElem[0];
		
		if 		(realData.search("ORIENTATION") > 0) {	document.getElementById("ins-align").className = "panel panel-danger";		} //8
		else if (realData.search("INITIALPOS") > 0) {	document.getElementById("ins-align").className = "panel panel-danger";		} //9
		else if (realData.search("FREE") > 0) {	 		document.getElementById("ins-align").className = "panel panel-warning";		} //6
		else if (realData.search("INACTIVE") > 0) {		document.getElementById("ins-align").className = "panel panel-danger";		} //0
		else if (realData.search("ALIGNING") > 0) {		document.getElementById("ins-align").className = "panel panel-warning";		} //1
		else if (realData.search("VARIANCE") > 0) {	 	document.getElementById("ins-align").className = "panel panel-warning";		} //2
		else if (realData.search("COMPLETE") > 0) {		document.getElementById("ins-align").className = "panel panel-success";		} //7
		else if (realData.search("GOOD") > 0) {	 		document.getElementById("ins-align").className = "panel panel-success";		} //3	
		
		else if (realData.search("FREEWHEELING") > 0) {	document.getElementById("ins-align").className = "panel panel-warning";		}
	});
// ================================================== //

// =========== /GPS/FIX TOPIC SUBSCRIPTION ========== //

	var gpsData = new ROSLIB.Topic({
		ros : ros,
		name : '/gps/fix', // "rostopic list" in a terminal to get topics
		messageType : 'sensor_msgs/NavSatFix' // "rostopic type [topicName]" in a terminal to get messageType
	}); 
	
	gpsData.subscribe(function(message) {
		realData = (JSON.stringify(message));
		dataArray = realData.split(",");
		alt = (dataArray[2].split('"'))[2].substring(1);
		lon = (dataArray[3].split('"'))[2].substring(1,14);
		lat = (dataArray[17].split('"'))[2].substring(1,15);
		//console.log(alt, lat, lon);
	  	document.getElementById("gps-sub").innerHTML = "Altitude: "+alt+"<br><br>Latitude: "+lat+"<br>Longitude: "+lon;
	  	document.getElementById("gps-align").className = "panel panel-success";
	});
	
	
// ================================================== //  

// ========== /IMU_DATA TOPIC SUBSCRIPTION ========== //

	var imuData = new ROSLIB.Topic({
		ros : ros,
		name : 'imu/raw', // "rostopic list" in a terminal to get topics
		messageType : 'sensor_msgs/Imu' // "rostopic type [topicName]" in a terminal to get messageType
	}); 
	
	imuData.subscribe(function(message) {
		realData = (JSON.stringify(message));
		dataArray = realData.split(",");
		accelY = (dataArray[35].split('"'))[4].substr(1,15);
		accelX = (dataArray[36].split('"'))[2].substr(1,15);
		accelZ = (dataArray[37].split('"'))[2].substr(1,15);
		
		velY = (dataArray[38].split('"'))[4].substr(1,15);
		velX = (dataArray[39].split('"'))[2].substr(1,15);
		velZ = (dataArray[40].split('"'))[2].substr(1,15);
		
		//console.log(dataArray);
		//console.log(velY, velX, velZ);
	  	document.getElementById("imu-sub").innerHTML = "<center>Linear Acceleration</center>X: "+accelX+"<br>Y: "+accelY+"<br>Z: "+accelZ+"<br><br><center>Angular Velocity</center>X: "+velX+"<br>Y: "+velY+"<br>Z: "+velZ;
	  	//"<br><br>Latitude: "+lat+"<br>Longitude: "+lon ;
	  	document.getElementById("imu-align").className = "panel panel-success";
	});
	
	
// ================================================== //  

// ============ /ODOM TOPIC SUBSCRIPTION ============ //

	var odomData = new ROSLIB.Topic({
		ros : ros,
		name : '/odom', // "rostopic list" in a terminal to get topics
		messageType : 'nav_msgs/Odometry' // "rostopic type [topicName]" in a terminal to get messageType
	}); 
	
	odomData.subscribe(function(message) {
		console.log("stuff");
		newData = (JSON.stringify(message));
		dataArray = realData.split(",");
		posY = (dataArray[46].split('"'))[8].substr(1,15);
		posX = (dataArray[47].split('"'))[2].substr(1,15);
				
		orientZ = (dataArray[49].split('"'))[2].substr(1,15);
		orientW = (dataArray[50].split('"'))[2].substr(1,15);
		
		console.log(posY);
		//console.log(velY, velX, velZ);
	  	document.getElementById("odom-sub").innerHTML = "<center>Position</center>X: "+posX+"<br>Y: "+posY+"<br><center>Orientation</center>Z: "+orientZ+"<br>W: "+orientW;
	  	//"<br><br>Latitude: "+lat+"<br>Longitude: "+lon ;
	  	//document.getElementById("odom-align").className = "panel panel-success";
	//~ 
	});
	//~ //position Y [46] = "pose":{"pose":{"position":{"y":4.5072942933795614
	//~ //position X [47] = "x":1.5276708407690165

	//~ //orient Z [51] = "z":0.9735931216614143
	//~ //orient W [52] = "w":0.22829023950572783}}
	
// ================================================== //  
   
  // If there is an error on the backend, an 'error' emit will be emitted.
	  ros.on('error', function(error) {
		document.getElementById('connecting').style.display = 'none';
		document.getElementById('connected').style.display = 'none';
		document.getElementById('closed').style.display = 'none';
		document.getElementById('error').style.display = 'inline';
		console.log(error);
	  });

  // Find out exactly when we made a connection.
	  ros.on('connection', function() {
		console.log('Connection made!');
		document.getElementById('connecting').style.display = 'none';
		document.getElementById('error').style.display = 'none';
		document.getElementById('closed').style.display = 'none';
		document.getElementById('connected').style.display = 'inline';
	  });
  // Close Connection
	  ros.on('close', function() {
		console.log('Connection closed.');
		document.getElementById('connecting').style.display = 'none';
		document.getElementById('connected').style.display = 'none';
		document.getElementById('closed').style.display = 'inline';
	  });
console.log("test 1");

  // Create a connection to the rosbridge WebSocket server.
  //ros.connect('ws://10.42.0.1:9090');       //Use this For connecting to Iggy
  ros.connect('ws://127.0.0.1:9090');       //Use this For running from RosBags
  
    
  
 //jQuery
$(document).ready(function(){  
  


});
  
  
</script> 
</head>

<body>

  <nav class="navbar navbar-inverse navbar-fixed-top">
	  <div class="container">
		<div class="navbar-header">
		  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
			<span class="sr-only">Toggle navigation</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		  </button>
		  <a class="navbar-brand" href="#">IGVC - The Future is Meow</a>
		</div>
	  </div>
  </nav><br><br><br><br>

  <div class = "container">
	  <center>
	  <p style="color:#FFF;"><h1> IGVC Diagnostics </h1> </p>
	  
	  <div id="statusIndicator">
		<p id="connecting">
		  Connecting to rosbridge...
		</p>
		<p id="connected" style="color:#00D600; display:none">
		  Connected
		</p>
		<p id="error" style="color:#FF0000; display:none">
		  Error in the back end!
		</p>
		<p id="closed" style="display:none">
		  Connection closed.
		</p>
	  </div><br>
		<br>
		<br>

<!-------------  ALL FEEDBACK WINDOWS -------------->
  <div class = "container">
	<div class = "row">
<!-------------  INS ALIGNMENT WINDOW -------------->
	  <div class = "col-md-4">
		<div class = "panel panel-danger"  id="ins-align">
		  <div class = "panel-heading"><b><u>INS Status</u></b></div>
		  <div class = "panel-heading" id="ins-sub">Loading... </div>
		</div>
	  </div>
	  
	  
<!------------  GPS LOCALIZATION WINDOW ------------>
	  <div class = "col-md-4">
		<div class = "panel panel-danger"  id="gps-align">
		  <div class = "panel-heading"><b><u>GPS Localization</u></b></div>
		  <div class = "panel-heading" id = "gps-sub">No GPS Signal...</div>
		</div>
	  </div>

<!------------  BATTERY PERCENT WINDOW ------------->
	  <div class = "col-md-4">
		  <div class = "panel panel-danger">
		  <div class = "panel-heading"><b><u>Battery Percentage</u></b></div>
		  <div class = "panel-heading" id = "bat-sub"><h1>14%</h1></div>
		</div>
	  </div>
<!-------------------------------------------------->      
	</div>

<!-------------- SECOND ROW WINDOWS ---------------->
<!------------- IMU ACCELERATION DATA -------------->
	<div class = "row">
	  <div class = "col-md-4">
		<div class = "panel panel-danger"  id="imu-align">
		  <div class = "panel-heading"><b><u>IMU Data</u></b></div>
		  <div class = "panel-heading" id="imu-sub">Loading... </div>
		</div>
	  </div>
	  
	  
<!---------------  REAL TIME ODOMETRY -------------->
	  <div class = "col-md-4">
		<div class = "panel panel-danger"  id="odom-align">
		  <div class = "panel-heading"><b><u>Real Time Odometry</u></b></div>
		  <div class = "panel-heading" id = "odom-sub">No Odom Data...</div>
		</div>
	  </div>

<!-------------- VELODYNE PUBLISHING --------------->
	  <div class = "col-md-4">
		  <div class = "panel panel-danger" id="vel-align">
		  <div class = "panel-heading"><b><u>Velodyne Status</u></b></div>
		  <div class = "panel-heading" id = "vel-sub">Not Publishing...</div>
		</div>
	  </div>
<!-------------------------------------------------->      
	</div>
  </div>



	  
	  </center>
	</div>
</body>


</html>
